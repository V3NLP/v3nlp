<?xml version="1.0" encoding="UTF-8"?>

<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:gate="http://gate.ac.uk/ns/spring"
	xmlns:p="http://www.springframework.org/schema/p" xmlns:context="http://www.springframework.org/schema/context"
	xmlns:flex="http://www.springframework.org/schema/flex"
	xsi:schemaLocation="http://www.springframework.org/schema/beans
       		http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
       		http://gate.ac.uk/ns/spring  
       		http://gate.ac.uk/ns/spring.xsd
       		http://www.springframework.org/schema/context 
       		http://www.springframework.org/schema/context/spring-context-2.5.xsd
       		http://www.springframework.org/schema/flex 
            http://www.springframework.org/schema/flex/spring-flex-1.0.xsd">
	<bean
		class="org.springframework.context.annotation.CommonAnnotationBeanPostProcessor" />

	<bean
		class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
		<property name="location">
			<value>classpath:v3nlp-server.properties</value>
		</property>
	</bean>

	<bean id="dataSource" class="org.springframework.jndi.JndiObjectFactoryBean"
		p:jndiName="java:comp/env/jdbc/expressionlib" p:resourceRef="true" />

	<bean id="expressionService"
		class="gov.va.research.inlp.expressionlib.ExpressionServiceImpl"
		p:dataSource-ref="dataSource" />

	<bean name="nlpService" class="gov.va.research.inlp.DefaultNlpServiceImpl"
		p:sectionizerAndConceptFinder-ref="sectionizerAndConceptFinder"
		p:metamapProvider-ref="metamapProvider"
		p:negationProvider-ref="negationProvider"
		p:databaseRepositoryService-ref="databaseRepositoryService">
		<property name="annotationTypesToReturn">
			<list>
				<value>RegEx</value>
				<value>UMLSConcept</value>
				<value>Negation</value>
			</list>
		</property>
	</bean>

	<bean name="negationProvider" class="gov.va.research.inlp.services.NegationImpl" init-method="init">
		<property name="sentenceRulesFile">
			<value type="org.springframework.core.io.Resource">WEB-INF/resources/EnglishSD.bin.gz</value>
		</property>
		<property name="negationRulesFile">
			<value type="org.springframework.core.io.Resource">WEB-INF/resources/negex/rules.txt</value>
		</property>
	</bean>


	<bean name="sectionizerAndConceptFinder"
		class="gov.va.research.inlp.services.SectionizerAndConceptFinderImpl">
		<lookup-method name="createConceptFinder" bean="defaultRegexConceptFinder" />

		<lookup-method name="createSectionizer" bean="defaultSectionizer" />

		<property name="sectionizerHeaders">
			<value type="org.springframework.core.io.Resource">WEB-INF/resources/sectionizer/dis_headers.xml
			</value>
		</property>

		<property name="annotationTypesToReturn">
			<list>
				<value>concept</value>
				<value>section_header</value>
			</list>
		</property>
	</bean>


	<bean id="utilityService" class="gov.va.research.inlp.UtilityServiceImpl" />

	<bean id="metamapProvider" class="gov.va.research.inlp.services.MetamapProviderImpl"
		p:restTemplate-ref="restTemplate" p:metamapService-ref="metamapService" />

	<bean id="metamapService"
		class="org.springframework.remoting.httpinvoker.HttpInvokerProxyFactoryBean"
		p:serviceUrl="${metamapServerUrl}"
		p:serviceInterface="gov.va.research.v3nlp.common.metamap.MetaMapServiceHttpInvoker" />

	<bean id="restTemplate" class="org.springframework.web.client.RestTemplate" />
			  
	<bean id="databaseRepositoryService" class="gov.va.research.inlp.DatabaseRespositoryServiceImpl">
		<property name="repositories">
			<list>
				<ref bean="vinciTuiRepository" />
				<ref bean="ordZengRepository" />
			</list>
		</property>
	</bean>

	<bean id="vinciTuiRepository" class="gov.va.research.v3nlp.repo.DBRepository"
		p:url="jdbc:sqlserver://vhacdwrb01:1433;databaseName=VINCI_TIU;user={username};password={password}"
		p:driverClassName="com.microsoft.sqlserver.jdbc.SQLServerDriver"
		p:schema="VINCI_TIU.TIU" p:table="TIUDocument" p:uidColumn="TIUDocumentSID"
		p:textColumn="ReportText" p:firstRow="1" p:maxResults="1000"
		p:name="VINCI TUI Repository" />

	<bean id="ordZengRepository" class="gov.va.research.v3nlp.repo.DBRepository"
		p:url="jdbc:sqlserver://vhacdwrb01:1433;databaseName=ORD_Zeng_20100321;user={username};password={password}"
		p:driverClassName="com.microsoft.sqlserver.jdbc.SQLServerDriver"
		p:schema="ORD_Zeng_20100321.dflt" p:table="TIUDocument_subset"
		p:uidColumn="TIUDocumentSID" p:textColumn="ReportText" 
		p:name="Zeng Repository" />

</beans>
